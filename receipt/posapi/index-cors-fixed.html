<!DOCTYPE html>
<html>
  <head>
    <title>Kivra POS API Documentation</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:300,400,700"
      rel="stylesheet"
    />
    <link href="../../assets/redoc-styles.css" rel="stylesheet" />
    <link
      rel="shortcut icon"
      href="../../assets/icon-32x32.png"
      sizes="192x192"
      type="image/png"
    />
  </head>
  <body>
    <div id="redoc-container">
      <div style="text-align: center; padding: 50px;">
        <h2>Loading API Documentation...</h2>
        <p>Please wait while we load the POS API specification.</p>
      </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/redoc@next/bundles/redoc.standalone.js"></script>
    <script>
      console.log('Starting to load POS API specification...');
      
      // Function to load and render the API spec
      function loadApiSpec() {
        const specUrl = 'posapi.yaml';
        console.log('Fetching:', specUrl);
        
        fetch(specUrl, {
          method: 'GET',
          headers: {
            'Accept': 'application/x-yaml, text/yaml, text/plain, */*',
          },
          mode: 'cors', // Explicitly request CORS
          cache: 'no-cache' // Avoid caching issues during development
        })
        .then(response => {
          console.log('Response status:', response.status);
          console.log('Response headers:', [...response.headers.entries()]);
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          return response.text();
        })
        .then(yamlText => {
          console.log('YAML loaded successfully, length:', yamlText.length);
          
          // Initialize Redoc with the YAML content
          Redoc.init(yamlText, {
            scrollYOffset: 60,
            hideHostname: false,
            hideDownloadButton: false,
            theme: {
              colors: {
                primary: {
                  main: '#32329f'
                }
              }
            }
          }, document.getElementById('redoc-container'));
          
          console.log('Redoc initialized successfully');
        })
        .catch(error => {
          console.error('Error loading API spec:', error);
          
          // Show detailed error information
          const container = document.getElementById('redoc-container');
          container.innerHTML = `
            <div style="padding: 40px; max-width: 800px; margin: 0 auto; font-family: Arial, sans-serif;">
              <h1 style="color: #d32f2f; margin-bottom: 20px;">❌ API Documentation Load Error</h1>
              
              <div style="background: #ffebee; border-left: 4px solid #f44336; padding: 15px; margin: 20px 0;">
                <h3 style="margin-top: 0; color: #c62828;">CORS Error Detected</h3>
                <p><strong>Error:</strong> ${error.message}</p>
                <p>The API specification file could not be loaded due to Cross-Origin Resource Sharing (CORS) restrictions.</p>
              </div>
              
              <div style="background: #f5f5f5; border: 1px solid #ddd; padding: 15px; margin: 20px 0; border-radius: 4px;">
                <h3 style="margin-top: 0;">Troubleshooting Steps:</h3>
                <ol style="line-height: 1.6;">
                  <li><strong>Check server configuration:</strong> Ensure nginx is running with CORS headers enabled</li>
                  <li><strong>Verify file exists:</strong> Confirm <code>posapi.yaml</code> is accessible at <a href="posapi.yaml" target="_blank">posapi.yaml</a></li>
                  <li><strong>Browser cache:</strong> Try hard refresh (Ctrl+F5 or Cmd+Shift+R)</li>
                  <li><strong>Network tab:</strong> Check browser DevTools → Network tab for failed requests</li>
                </ol>
              </div>
              
              <div style="background: #e8f5e8; border: 1px solid #4caf50; padding: 15px; margin: 20px 0; border-radius: 4px;">
                <h3 style="margin-top: 0; color: #2e7d32;">For Developers:</h3>
                <p>If running locally with Docker:</p>
                <pre style="background: #f8f8f8; padding: 10px; border-radius: 4px; overflow-x: auto;"><code>docker-compose down
docker-compose build
docker-compose up</code></pre>
              </div>
              
              <p style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #666;">
                <strong>Need help?</strong> Contact the development team with the error details above.
              </p>
            </div>
          `;
        });
      }
      
      // Start loading when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadApiSpec);
      } else {
        loadApiSpec();
      }
    </script>
  </body>
</html>